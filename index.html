<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepCode - Deep16 (深十六) Integrated Development Environment</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div class="header-container">
        <div class="header">
            <div class="header-content">
                <div class="logo-container">
                    <img src="gfx/Deep16_mouse.svg" alt="Deep16 Mouse Logo" class="deep16-logo">
                </div>
                <div class="header-text">
                    <h1>DeepCode - Deep16 (深十六) IDE</h1>
                    <div class="subtitle">Architecture v3.5 (1r13) - Integrated Assembler & Simulator</div>
                </div>
                <div class="header-spacer"></div>
                <div class="header-right-controls">
                    <label class="toggle-label">WASM
                        <input type="checkbox" id="wssam-toggle" checked>
                    </label>
                </div>
            </div>
        </div>
        <div class="transcript-panel">
            <div id="transcript" class="transcript">
                <!-- Transcript entries will appear here -->
            </div>
        </div>
    </div>
    <div id="mobile-controls" class="mobile-controls" style="display:none"></div>
    
    <div class="container">
    <!-- Editor Panel -->
    <div class="editor-panel">
        <div class="tab-container">
            <!-- Tier 2: Tabs for Editor, Errors, Listing -->
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="editor">Editor</button>
                <button class="tab-button" data-tab="errors">Errors</button>
                <button class="tab-button" data-tab="listing">Listing</button>
                <button class="tab-button" data-tab="screen">Screen</button>                 
            </div>
            
            <!-- Tier 3 & 4: Inside the Editor tab -->
            <div id="editor-tab" class="tab-content active">
                <!-- Tier 3: File and Edit menus inside Editor tab -->
                <div class="editor-header">
                    <div class="file-menu">
                        <button id="file-menu-btn">File ▾</button>
                        <div class="file-dropdown" id="file-dropdown">
                            <button id="new-file-btn">New</button>
                            <button id="load-file-btn">Load...</button>
                            <button id="save-file-btn">Save</button>
                            <button id="save-as-btn">Save As...</button>
                            <button id="print-btn">Print</button>
                        </div>
                    </div>
                    <div class="edit-menu">
                        <button id="edit-menu-btn">Edit ▾</button>
                        <div class="edit-dropdown" id="edit-dropdown">
                            <button id="undo-btn">Undo</button>
                            <button id="redo-btn">Redo</button>
                            <div class="menu-divider"></div>
                            <button id="cut-btn">Cut</button>
                            <button id="copy-btn">Copy</button>
                            <button id="paste-btn">Paste</button>
                            <div class="menu-divider"></div>
                            <button id="select-all-btn">Select All</button>
                            <button id="find-btn">Find</button>
                        </div>
                    </div>
                    <!-- Mobile mini menu (File + Edit combined) -->
                    <div class="mini-menu" id="mini-menu" style="display:none">
                        <button id="mini-menu-btn" class="mini-menu-btn">▶</button>
                        <div id="mini-menu-panel" class="mini-menu-panel"></div>
                    </div>
                    
                    <!-- Examples and Assemble button -->
                    <div class="editor-controls-center">
                        <label for="example-select">Load Example:</label>
                        <select id="example-select" style="width: 200px;">
                            <option value="">-- Loading Examples --</option>
                        </select>
                        <button id="assemble-btn">Assemble</button>
                    </div>
                </div>
                
                <!-- Tier 4: Filename and status below menus -->
                <div class="file-status-line">
                    <span id="current-filename">Untitled.asm</span>
                    <span id="file-status" class="file-status-clean">● Clean</span>
                </div>
                
                <!-- Editor textarea -->
                <textarea id="editor" class="editor" spellcheck="false">; Deep16 (深十六) Integrated Development Environment
; Select an example from the dropdown or write your own code
; Then click 'Assemble' to compile and 'Run' to execute

.org 0x0000

main:
    ; Your Deep16 code here
    LSI R0, 14        ; Example: load immediate value
    ST  R0, [R0 +21]    ; Example: store to memory
    MOV R1, R0 +1
    
    HALT

.org 0x0200
data_area:
    .word 0</textarea>
            </div>
            
            <div id="errors-tab" class="tab-content">
                <div id="errors-list" class="errors-list">
                    <div class="no-errors">No assembly performed yet</div>
                </div>
            </div>
            
            <div id="listing-tab" class="tab-content">
                <div class="listing-controls">
                    <label for="listing-symbol-select">Navigate to symbol:</label>
                    <select id="listing-symbol-select" size="1" style="width: 200px;">
                        <option value="">-- Select Symbol --</option>
                    </select>
                </div>
                <div id="listing-content" class="assembly-listing">
                    No assembly performed yet
                </div>
            </div>
            <div id="screen-tab" class="tab-content">
                <div class="screen-tab">
                    <div class="screen-display" id="screen-display">
                        <!-- 80x25 character grid will be populated by JavaScript -->
                    </div>
                    <div class="screen-info">
                        Memory: 0xF1000-0xF17CF (80×25 characters) | Lower byte = ASCII character
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
    <!-- Memory & Registers Panel -->
    <div class="memory-panel">
        <div class="panel-header">
            <div class="panel-header-title">Deep16 Memory & Registers</div>
            <div class="memory-panel-controls">
                <button id="run-btn" disabled>Run</button>
                <span id="run-state-indicator" class="run-indicator run-indicator-halt">Halt</span>
                <button id="step-btn" disabled>Step</button>
                <button id="reset-btn" disabled>Reset</button>
                <button id="view-toggle" class="view-toggle">Compact View</button>
            </div>
        </div>
        <div class="registers-container">
            <!-- PSW Display -->
            <div class="register-section">
                <div class="section-title">Processor Status Word (PSW)</div>
                <div class="psw-display">
                    <div class="psw-bits">
                        <div class="psw-bit">
                            <span class="psw-label">DE</span>
                            <input type="checkbox" class="psw-checkbox" id="psw-de" disabled>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">ER</span>
                            <span class="psw-value-display" id="psw-er">0</span>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">DS</span>
                            <input type="checkbox" class="psw-checkbox" id="psw-ds" disabled>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">SR</span>
                            <span class="psw-value-display" id="psw-sr">0</span>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">S</span>
                            <input type="checkbox" class="psw-checkbox" id="psw-s" disabled>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">I</span>
                            <input type="checkbox" class="psw-checkbox" id="psw-i" disabled>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">C</span>
                            <input type="checkbox" class="psw-checkbox" id="psw-c" disabled>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">V</span>
                            <input type="checkbox" class="psw-checkbox" id="psw-v" disabled>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">Z</span>
                            <input type="checkbox" class="psw-checkbox" id="psw-z" disabled>
                        </div>
                        <div class="psw-bit">
                            <span class="psw-label">N</span>
                            <input type="checkbox" class="psw-checkbox" id="psw-n" disabled>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- General Purpose Registers -->
            <div class="register-section">
                <div class="section-title"><span class="section-toggle">▼</span>General Purpose Registers (R0-R15)</div>
                <div class="register-grid" id="register-grid">
                    <!-- Filled by JavaScript -->
                </div>
            </div>
            
            <!-- Segment Registers -->
            <div class="register-section">
                <div class="section-title"><span class="section-toggle">▼</span>Segment Registers</div>
                <div class="register-grid">
                    <div class="register-compact">
                        <span class="register-name">CS</span>
                        <span class="register-value" id="reg-cs">0x0000</span>
                    </div>
                    <div class="register-compact">
                        <span class="register-name">DS</span>
                        <span class="register-value" id="reg-ds">0x0000</span>
                    </div>
                    <div class="register-compact">
                        <span class="register-name">SS</span>
                        <span class="register-value" id="reg-ss">0x0000</span>
                    </div>
                    <div class="register-compact">
                        <span class="register-name">ES</span>
                        <span class="register-value" id="reg-es">0x0000</span>
                    </div>
                </div>
            </div>
            
            <!-- Shadow Registers -->
            <div class="register-section shadow-section">
                <div class="section-title"><span class="section-toggle">▼</span>Shadow Registers (Interrupt Context)</div>
                <div class="register-grid">
                    <div class="register-compact">
                        <span class="register-name">PSW'</span>
                        <span class="register-value" id="reg-psw-shadow">0x0000</span>
                    </div>
                    <div class="register-compact">
                        <span class="register-name">PC'</span>
                        <span class="register-value" id="reg-pc-shadow">0x0000</span>
                    </div>
                    <div class="register-compact">
                        <span class="register-name">CS'</span>
                        <span class="register-value" id="reg-cs-shadow">0x0000</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel-header" id="memory-breakpoints-header">Memory Display (Word Addressing)</div>
<!-- In index.html - Replace memory-controls with this clean version: -->
<div class="memory-controls">
    <!-- Left: Memory Address Controls -->
    <div class="memory-address-controls">
        <label for="memory-start-address">Start:</label>
        <input type="text" id="memory-start-address" value="0x00000" placeholder="0x00000">
        <label for="symbol-select">Symbol:</label>
        <select id="symbol-select" size="1">
            <option value="">-- Select Symbol --</option>
        </select>
    </div>
    
    <!-- Vertical Divider -->
    <div class="controls-divider"></div>
    
    <!-- Right: Segmented Navigation -->
    <div class="segment-navigation">
        <label>CS::PC:</label>
        <input type="text" id="cs-input" value="0x0000" placeholder="CS">
        <span class="segment-divider">::</span>
        <input type="text" id="pc-input" value="0x0000" placeholder="PC">
        <button id="goto-segment-btn">Go to</button>
    </div>
</div>
        <div id="memory-display" class="memory-display">
            <!-- Memory content will be populated by JavaScript -->
        </div>
        <div class="recent-memory-panel">
            <div class="panel-header">Recent Memory Access Location</div>
            <div id="recent-memory-display" class="recent-memory-display">
                No memory operations yet
            </div>
        </div>
    </div>
</div>
    
    <div id="status-bar" class="status-bar">
        DeepCode Ready - Architecture v3.5 (1r11a) - Enter assembly code and click 'Assemble'
    </div>

    <script src="js/deep16_assembler.js?v=20251126-1"></script>
    <script src="js/deep16_disassembler.js?v=20251126-1"></script>
    <script src="js/deep16_simulator.js?v=20251126-1"></script>
    <script src="js/deep16_ui_registers.js?v=20251126-1"></script>
    <script src="js/deep16_ui_memory.js?v=20251126-1"></script>
    <script src="js/deep16_ui_screen.js?v=20251126-1"></script>    
    <script type="module">
        try {
            const modPromise = import('./wasm/pkg/deep16_wasm.js?v=20251126-1');
            modPromise.then(async (wasm) => {
                const initPromise = wasm.default({ module_or_path: new URL('./wasm/pkg/deep16_wasm_bg.wasm?v=20251126-1', import.meta.url) });
                window.Deep16WasmReady = initPromise;
                window.Deep16Wasm = wasm;
                await initPromise;
                window.dispatchEvent(new Event('deep16-wasm-ready'));
            }).catch((e) => {
                console.warn('WASM module not loaded', e);
            });
        } catch (e) {
            console.warn('WASM module not loaded', e);
        }
    </script>
    <script src="js/deep16_ui_core.js"></script>
</body>
</html>
